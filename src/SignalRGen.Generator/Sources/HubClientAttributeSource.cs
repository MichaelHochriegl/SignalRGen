using System.Text;
using Microsoft.CodeAnalysis;
using Microsoft.CodeAnalysis.CSharp;
using Microsoft.CodeAnalysis.CSharp.Syntax;
using Microsoft.CodeAnalysis.Text;
using static Microsoft.CodeAnalysis.CSharp.SyntaxFactory;

namespace SignalRGen.Generator.Sources;

internal static class HubClientAttributeSource
{
    internal static SourceText GetSource() => CompilationUnit()
        .WithUsings(
            List<UsingDirectiveSyntax>(
                new UsingDirectiveSyntax[]{
                    UsingDirective(IdentifierName("System"))
                        .WithUsingKeyword(AutoGeneratedHintSource.GetSyntaxToken(SyntaxKind.UsingKeyword))}))
        .WithMembers(
            SingletonList<MemberDeclarationSyntax>(
                FileScopedNamespaceDeclaration(
                        QualifiedName(
                            IdentifierName("SignalRGen"),
                            IdentifierName("Generator")))
                    .WithNamespaceKeyword(NullableEnabledSource.GetSyntaxToken(SyntaxKind.NamespaceKeyword))
                    .WithMembers(
                        SingletonList<MemberDeclarationSyntax>(
                            ClassDeclaration("HubClientAttribute")
                                .WithAttributeLists(
                                    SingletonList<AttributeListSyntax>(
                                        AttributeList(
                                                SingletonSeparatedList<
                                                    AttributeSyntax>(
                                                    Attribute(
                                                            IdentifierName(
                                                                "AttributeUsage"))
                                                        .WithArgumentList(
                                                            AttributeArgumentList(
                                                                SingletonSeparatedList
                                                                    <AttributeArgumentSyntax>(
                                                                        AttributeArgument(
                                                                            MemberAccessExpression(
                                                                                SyntaxKind
                                                                                    .SimpleMemberAccessExpression,
                                                                                IdentifierName(
                                                                                    "AttributeTargets"),
                                                                                IdentifierName(
                                                                                    "Interface"))))))))
                                            .WithOpenBracketToken(
                                                Token(
                                                    TriviaList(
                                                        Trivia(
                                                            DocumentationCommentTrivia(
                                                                SyntaxKind
                                                                    .SingleLineDocumentationCommentTrivia,
                                                                List<
                                                                    XmlNodeSyntax>(
                                                                    new
                                                                        XmlNodeSyntax
                                                                        []
                                                                        {
                                                                            XmlText()
                                                                                .WithTextTokens(
                                                                                    TokenList(
                                                                                        XmlTextLiteral(
                                                                                            TriviaList(
                                                                                                DocumentationCommentExterior(
                                                                                                    "///")),
                                                                                            " ",
                                                                                            " ",
                                                                                            TriviaList()))),
                                                                            XmlExampleElement(
                                                                                    SingletonList
                                                                                        <XmlNodeSyntax>(
                                                                                            XmlText()
                                                                                                .WithTextTokens(
                                                                                                    TokenList(
                                                                                                        new
                                                                                                            []
                                                                                                            {
                                                                                                                XmlTextNewLine(
                                                                                                                    TriviaList(),
                                                                                                                    "\n",
                                                                                                                    "\n",
                                                                                                                    TriviaList()),
                                                                                                                XmlTextLiteral(
                                                                                                                    TriviaList(
                                                                                                                        DocumentationCommentExterior(
                                                                                                                            "///")),
                                                                                                                    " Marker Attribute for a HubClient.",
                                                                                                                    " Marker Attribute for a HubClient.",
                                                                                                                    TriviaList()),
                                                                                                                XmlTextNewLine(
                                                                                                                    TriviaList(),
                                                                                                                    "\n",
                                                                                                                    "\n",
                                                                                                                    TriviaList()),
                                                                                                                XmlTextLiteral(
                                                                                                                    TriviaList(
                                                                                                                        DocumentationCommentExterior(
                                                                                                                            "///")),
                                                                                                                    " ",
                                                                                                                    " ",
                                                                                                                    TriviaList())
                                                                                                            }))))
                                                                                .WithStartTag(
                                                                                    XmlElementStartTag(
                                                                                        XmlName(
                                                                                            Identifier(
                                                                                                "summary"))))
                                                                                .WithEndTag(
                                                                                    XmlElementEndTag(
                                                                                        XmlName(
                                                                                            Identifier(
                                                                                                "summary")))),
                                                                            XmlText()
                                                                                .WithTextTokens(
                                                                                    TokenList(
                                                                                        XmlTextNewLine(
                                                                                            TriviaList(),
                                                                                            "\n",
                                                                                            "\n",
                                                                                            TriviaList())))
                                                                        })))),
                                                    SyntaxKind.OpenBracketToken,
                                                    TriviaList()))))
                                .WithModifiers(
                                    TokenList(
                                        new[]
                                        {
                                            Token(SyntaxKind.PublicKeyword),
                                            Token(SyntaxKind.SealedKeyword)
                                        }))
                                .WithBaseList(
                                    BaseList(
                                        SingletonSeparatedList<BaseTypeSyntax>(
                                            SimpleBaseType(
                                                IdentifierName("Attribute")))))
                                .WithMembers(
                                    List<MemberDeclarationSyntax>(
                                        new MemberDeclarationSyntax[]
                                        {
                                            PropertyDeclaration(
                                                    NullableType(
                                                        PredefinedType(
                                                            Token(SyntaxKind
                                                                .StringKeyword))),
                                                    Identifier("HubName"))
                                                .WithModifiers(
                                                    TokenList(
                                                        Token(SyntaxKind
                                                            .PublicKeyword)))
                                                .WithAccessorList(
                                                    AccessorList(
                                                        List<
                                                            AccessorDeclarationSyntax>(
                                                            new
                                                                AccessorDeclarationSyntax
                                                                []
                                                                {
                                                                    AccessorDeclaration(
                                                                            SyntaxKind
                                                                                .GetAccessorDeclaration)
                                                                        .WithSemicolonToken(
                                                                            Token(
                                                                                SyntaxKind
                                                                                    .SemicolonToken)),
                                                                    AccessorDeclaration(
                                                                            SyntaxKind
                                                                                .InitAccessorDeclaration)
                                                                        .WithSemicolonToken(
                                                                            Token(
                                                                                SyntaxKind
                                                                                    .SemicolonToken))
                                                                }))),
                                            PropertyDeclaration(
                                                    PredefinedType(
                                                        Token(SyntaxKind
                                                            .StringKeyword)),
                                                    Identifier("HubUri"))
                                                .WithModifiers(
                                                    TokenList(
                                                        new[]
                                                        {
                                                            Token(SyntaxKind
                                                                .PublicKeyword),
                                                            Token(SyntaxKind
                                                                .RequiredKeyword)
                                                        }))
                                                .WithAccessorList(
                                                    AccessorList(
                                                        List<
                                                            AccessorDeclarationSyntax>(
                                                            new
                                                                AccessorDeclarationSyntax
                                                                []
                                                                {
                                                                    AccessorDeclaration(
                                                                            SyntaxKind
                                                                                .GetAccessorDeclaration)
                                                                        .WithSemicolonToken(
                                                                            Token(
                                                                                SyntaxKind
                                                                                    .SemicolonToken)),
                                                                    AccessorDeclaration(
                                                                            SyntaxKind
                                                                                .InitAccessorDeclaration)
                                                                        .WithSemicolonToken(
                                                                            Token(
                                                                                SyntaxKind
                                                                                    .SemicolonToken))
                                                                })))
                                        }))))))
        .NormalizeWhitespace().GetText(Encoding.UTF8);
}